<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista 2</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="stylesheet" href="styles2.css">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
      integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
<body>
    <div class="fixed-container">
      <header>
        <h1>Cookies</h1>
      </header>
        <p>Adicionar uma venda</p>
        <div class="form-control">
          <form id="taskForm">
            <input
              type="text"
              id="taskInput"
              placeholder="Cliente"
            />
            <input
              type="text"
              id="valueInput"
              placeholder="Quantidade"
            />
            <button type="submit">Adicionar</button>
          </form>
        </div>

  <div id="taskList"></div>

  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyAGIWz0_aBCPipzvJtfkE4Mmh2uJPHkOU0",
  authDomain: "listavendas-6435b.firebaseapp.com",
  projectId: "listavendas-6435b",
  storageBucket: "listavendas-6435b.appspot.com",
  messagingSenderId: "245789738195",
  appId: "1:245789738195:web:270a1db545aefa0c88c026"
};

  // Inicializar o Firebase
    firebase.initializeApp(firebaseConfig);

    // Referenciar a coleção 'tasks' no Firestore
    const db = firebase.firestore();
    const tasksRef = db.collection('tasks');

    // Função para adicionar uma nova tarefa
    document.getElementById("taskForm").addEventListener("submit", function(event) {
  event.preventDefault(); // Impede o comportamento padrão de atualização da página
  addTask();
});

function addTask() {
  const taskInput = document.getElementById('taskInput');
  const valueInput = document.getElementById('valueInput');

  const task = taskInput.value.trim();
  const value = valueInput.value.trim();

  if (task !== '' && value !== '') {
    // Salvar a tarefa no Firestore com os campos adicionais
    tasksRef.add({ description: task, value: value })
      .then(() => {
        taskInput.value = '';
        valueInput.value = '';
        renderTasks(); // Atualiza a lista de tarefas na tela
      })
      .catch(error => {
        console.error('Erro ao adicionar a tarefa:', error);
      });
  }
}

    // Função para excluir uma tarefa
    function deleteTask(id) {
  // Pedir confirmação antes de excluir a tarefa
  const confirmed = confirm("Deseja realmente excluir esse lançamento?");
  if (confirmed) {
    // Excluir a tarefa do Firestore
    tasksRef.doc(id)
      .delete()
      .then(() => {
        renderTasks(); // Atualiza a lista de tarefas na tela
      })
      .catch(error => {
        console.error('Erro ao excluir a tarefa:', error);
      });
  }
}

function editTask(id, newDescription, newValue) {
  // Atualizar a descrição e o valor da tarefa no Firestore
  tasksRef
    .doc(id)
    .update({ description: newDescription, value: newValue })
    .then(() => {
      renderTasks(); // Atualiza a lista de tarefas na tela
    })
    .catch(error => {
      console.error('Erro ao editar a tarefa:', error);
    });
}

function handleEditButtonClick(id, description, value) {
  const newDescription = prompt('Nome do cliente:', description);
  const newValue = prompt('Valor:', value);
  if (newDescription !== null && newDescription.trim() !== '') {
    editTask(id, newDescription.trim(), newValue);
  }
}

    // Função para renderizar as tarefas na página
    function renderTasks() {
      const taskList = document.getElementById('taskList');
      taskList.innerHTML = '';

      // Obter as tarefas do Firestore
      tasksRef.get()
        .then(querySnapshot => {
          querySnapshot.forEach(doc => {
            const task = doc.data();
            const id = doc.id;

            const todoItem = document.createElement('div');
            todoItem.className = 'todo-item';
            if (task.completed) {
                todoItem.classList.add('completed');
              }

            const checkbox = document.createElement('input');
              checkbox.type = 'checkbox';
              checkbox.checked = task.completed; // Define o estado da checkbox
              checkbox.addEventListener('change', () => {
                toggleTaskCompleted(id, task.completed);
              });

            const taskText = document.createElement('span');
            taskText.textContent = task.description;

            const valueText = document.createElement('span');
            valueText.textContent = task.value;

            const deleteButton = document.createElement('button');
            deleteButton.innerHTML = `<i class="fa-solid fa-trash"></i>`;
            deleteButton.addEventListener('click', () => {
              deleteTask(id);
            });

            const editButton = document.createElement("button");
            editButton.innerHTML = `<i class="fa-solid fa-pencil"></i>`;
            editButton.addEventListener("click", () => {
            handleEditButtonClick(id, task.description, task.value);
            });


            todoItem.appendChild(taskText);
            todoItem.appendChild(valueText);
            todoItem.appendChild(checkbox);
            todoItem.appendChild(deleteButton);
            todoItem.appendChild(editButton);

            taskList.appendChild(todoItem);
          });
        })
        .catch(error => {
          console.error('Erro ao obter as tarefas:', error);
        });
    }

    // Função para marcar ou desmarcar uma tarefa como concluída
    function toggleTaskCompleted(id, completed) {
        // Atualizar a propriedade 'completed' da tarefa no Firestore
        tasksRef.doc(id).update({ completed: !completed })
          .then(() => {
            renderTasks(); // Atualiza a lista de tarefas na tela
          })
          .catch(error => {
            console.error('Erro ao atualizar a tarefa:', error);
          });
      }

    // Renderizar as tarefas ao carregar a página
    renderTasks();
  </script>
</body>
</html>